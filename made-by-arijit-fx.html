<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Paid Push Editable Table</title>

<!-- Google Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

<style>
  body {
    background: #121212;
    color: #f0f0f0;
    font-family: 'Noto Serif', serif;
    padding: 10px;
    max-width: 1000px;
    margin: auto;
  }
  h1 {
    text-align: center;
    margin-bottom: 15px;
    font-size: 2rem;
    color: #a7ffeb;
    text-shadow: 0 0 10px #64ffda;
  }
  .search-row {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  .search-row input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #64ffda;
    background: #263238;
    color: #a7ffeb;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    box-shadow: 0 0 15px #64ffda88;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #64ffda;
    padding: 8px;
    text-align: center;
    font-size: 1rem;
  }
  th {
    background: #004d40;
    color: #a7ffeb;
  }
  input[type="text"], input[type="number"] {
    width: 90%;
    padding: 4px;
    background: #263238;
    color: #a7ffeb;
    border: 1px solid #64ffda;
    border-radius: 4px;
    text-align: center;
  }
  input[type="text"] {
    text-align: left;
    padding-left: 10px;
  }
  button {
    cursor: pointer;
    padding: 5px 10px;
    margin: 2px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    color: white;
    transition: background 0.3s;
  }
  .plus { background: #00c853; }
  .plus:hover { background: #00e676; }
  .minus { background: #d50000; }
  .minus:hover { background: #ff1744; }
  .delete { background: #ff6f00; }
  .delete:hover { background: #ff9100; }
  .colorbtn { background: #2962ff; }
  .colorbtn:hover { background: #448aff; }
  #add-row-btn {
    display: block;
    margin: 20px auto;
    background: #2979ff;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 1.2rem;
    box-shadow: 0 0 15px #2979ffaa;
  }
  #add-row-btn:hover { background: #448aff; box-shadow: 0 0 25px #448affcc; }
  @media (max-width: 600px) {
    th, td { font-size: 0.9rem; padding: 6px; }
    input[type="text"], input[type="number"] { font-size: 0.9rem; }
  }
</style>
</head>
<body>

<h1>Paid Push Editable Table</h1>

<div class="search-row">
  <input type="text" id="search-no" placeholder="Search No.">
  <input type="text" id="search-name" placeholder="Search Name">
</div>

<table>
  <thead>
    <tr id="table-header">
      <th>No.</th>
      <th>Player Name</th>
      <th>Stars</th>
      <th id="actions-header">Actions</th>
    </tr>
  </thead>
  <tbody id="table-body"></tbody>
</table>

<button id="add-row-btn" style="display:none;">âž• Add New Player</button>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyChO1aC8iQLW7BbMHzEU0mJqGexo2kj0hE",
  authDomain: "red-paid-push-data.firebaseapp.com",
  databaseURL: "https://red-paid-push-data-default-rtdb.firebaseio.com",
  projectId: "red-paid-push-data",
  storageBucket: "red-paid-push-data.firebasestorage.app",
  messagingSenderId: "87626213146",
  appId: "1:87626213146:web:dd1c8575ccdaf33454aea3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Mode check
const params = new URLSearchParams(window.location.search);
const mode = params.get("mode");
const editMode = mode === "edit";

if (editMode) {
  const urlParams = new URLSearchParams(window.location.search);
const mode = urlParams.get("mode");

if (mode === "edit") {
  const pass = prompt("Enter password to edit:");
  if (pass !== "a7391") {
    alert("Wrong password! Switching to view mode.");
    window.location.search = "?mode=view";
  }
}
  document.getElementById("actions-header").style.display = "none";
}

const tableBody = document.getElementById("table-body");

// Live data load
onValue(ref(db, "players"), (snapshot) => {
  const data = snapshot.val() || {};
  renderTable(data);
});

function renderTable(data) {
  tableBody.innerHTML = "";
  const keys = Object.keys(data);
  keys.forEach((key, index) => {
    const player = data[key];
    const tr = document.createElement("tr");

    // No.
    const tdNo = document.createElement("td");
    tdNo.textContent = index + 1;
    tr.appendChild(tdNo);

    // Name
    const tdName = document.createElement("td");
    if (editMode) {
      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.value = player.name || "";
      nameInput.addEventListener("change", () => {
        update(ref(db, `players/${key}`), { name: nameInput.value });
      });
      tdName.appendChild(nameInput);
    } else {
      tdName.textContent = player.name || "";
    }
    tr.appendChild(tdName);

    // Stars
    const tdStars = document.createElement("td");
    if (editMode) {
      const starsInput = document.createElement("input");
      starsInput.type = "number";
      starsInput.value = player.stars || 0;
      starsInput.addEventListener("change", () => {
        update(ref(db, `players/${key}`), { stars: parseInt(starsInput.value) || 0 });
      });
      tdStars.appendChild(starsInput);
    } else {
      tdStars.textContent = player.stars || 0;
    }
    tr.appendChild(tdStars);

    // Actions (only edit mode)
    if (editMode) {
      const tdAct = document.createElement("td");

      const plusBtn = document.createElement("button");
      plusBtn.className = "plus";
      plusBtn.textContent = "+";
      plusBtn.onclick = () => update(ref(db, `players/${key}`), { stars: (player.stars || 0) + 1 });

      const minusBtn = document.createElement("button");
      minusBtn.className = "minus";
      minusBtn.textContent = "âˆ’";
      minusBtn.onclick = () => update(ref(db, `players/${key}`), { stars: Math.max(0, (player.stars || 0) - 1) });

      const delBtn = document.createElement("button");
      delBtn.className = "delete";
      delBtn.textContent = "ðŸ—‘";
      delBtn.onclick = () => { if (confirm("Delete player?")) remove(ref(db, `players/${key}`)); };

      const colorBtn = document.createElement("button");
      colorBtn.className = "colorbtn";
      colorBtn.textContent = "ðŸŽ¨";
      colorBtn.onclick = () => {
        const newColor = prompt("Enter color hex (e.g. #ff0000):", player.color || "#ffffff");
        if (newColor) update(ref(db, `players/${key}`), { color: newColor });
      };

      tdAct.appendChild(plusBtn);
      tdAct.appendChild(minusBtn);
      tdAct.appendChild(delBtn);
      tdAct.appendChild(colorBtn);

      tr.appendChild(tdAct);
    }

    tableBody.appendChild(tr);
  });
}

// Add new player
document.getElementById("add-row-btn").onclick = () => {
  const newRef = push(ref(db, "players"));
  set(newRef, { name: "New Player", stars: 0 });
};

// Search
document.getElementById("search-no").addEventListener("input", search);
document.getElementById("search-name").addEventListener("input", search);

function search() {
  const noVal = document.getElementById("search-no").value.toLowerCase();
  const nameVal = document.getElementById("search-name").value.toLowerCase();
  Array.from(tableBody.rows).forEach(row => {
    const no = row.cells[0].textContent.toLowerCase();
    const name = row.cells[1].textContent.toLowerCase();
    row.style.display = (no.includes(noVal) && name.includes(nameVal)) ? "" : "none";
  });
}
</script>

</body>
</html>
